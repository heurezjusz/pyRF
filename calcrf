#!/usr/bin/python3

import config

# parsing arguments
import argparse
parser = argparse.ArgumentParser()

parser.add_argument('files', type=str, nargs='+',
        help='names of files with data')

args = parser.parse_args()


# program itself
from core import output_filename, rotate_theoretical, rotate_search, calculate_rf

from obspy import read

for datafile in vars(args)['files']:
    # reading file
    data = read(datafile)
    
    if config.PLOT_DATA_FROM_FILE: data.plot()

    if config.MODE == "theoretical":
        data = rotate_theoretical(data)
    elif config.MODE == "search":
        data = rotate_search(data)
    else:
        raise NotImplementedError

    if config.SAVE_ROTATED:
        data.write(output_filename(datafile, prefix='rotated_'), config.SAVE_FORMAT)
    if config.PLOT_ROTATED: data.plot()

    data = calculate_rf(data, shift=config.RF_SHIFT)

    if config.SAVE_RF:
        data.write(output_filename(datafile, prefix='rf_'), config.SAVE_FORMAT)
    if config.PLOT_RF:
        data.plot()
